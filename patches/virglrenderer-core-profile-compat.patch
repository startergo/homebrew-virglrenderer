--- virgl-upstream/src/vrend/vrend_renderer.c	2026-01-25 22:00:00
+++ virgl-patched/src/vrend/vrend_renderer.c	2026-01-25 22:00:00
@@ -2867,7 +2867,7 @@
            }
         }
 
-        if (vrend_state.use_gles) {
+        if (vrend_state.use_gles || vrend_state.use_core_profile) {
            for (unsigned int i = 0; i < 4; ++i) {
               glTexParameteri(view->target, GL_TEXTURE_SWIZZLE_R + i, view->gl_swizzle[i]);
            }
@@ -3460,7 +3460,7 @@
       glBindVertexArray(v->id);
       for (uint32_t i = 0; i < v->count; i++) {
          struct vrend_vertex_element *ve = &v->elements[i];
-         GLint size = !vrend_state.use_gles && (v->zyxw_bitmask & (1 << i)) ? GL_BGRA : ve->nr_chan;
+         GLint size = (!vrend_state.use_gles && !vrend_state.use_core_profile) && (v->zyxw_bitmask & (1 << i)) ? GL_BGRA : ve->nr_chan;
 
          if (util_format_is_pure_integer(ve->base.src_format)) {
             UPDATE_INT_SIGN_MASK(ve->base.src_format, i,
@@ -3721,7 +3721,7 @@
                tex->cur_max = view->u.tex.last_level;
             }
             if (memcmp(tex->cur_swizzle, view->gl_swizzle, 4 * sizeof(GLint))) {
-               if (vrend_state.use_gles) {
+               if (vrend_state.use_gles || vrend_state.use_core_profile) {
                   for (unsigned int i = 0; i < 4; ++i) {
                      if (tex->cur_swizzle[i] != view->gl_swizzle[i]) {
                          glTexParameteri(view->texture->target, GL_TEXTURE_SWIZZLE_R + i, view->gl_swizzle[i]);
@@ -5148,7 +5148,7 @@
          glUnmapBuffer(GL_ARRAY_BUFFER);
          disable_bitmask |= (1 << loc);
       } else {
-         GLint size = !vrend_state.use_gles && (va->zyxw_bitmask & (1 << i)) ? GL_BGRA : ve->nr_chan;
+         GLint size = (!vrend_state.use_gles && !vrend_state.use_core_profile) && (va->zyxw_bitmask & (1 << i)) ? GL_BGRA : ve->nr_chan;
 
          enable_bitmask |= (1 << loc);
          if (util_format_is_pure_integer(ve->base.src_format)) {
@@ -5259,7 +5259,7 @@
              * not be applied, therefore, reset the swizzled to the default */
             static const GLint swizzle[] = {GL_RED,GL_GREEN,GL_BLUE,GL_ALPHA};
             if (memcmp(tex->cur_swizzle, swizzle, 4 * sizeof(GLint))) {
-               if (vrend_state.use_gles) {
+               if (vrend_state.use_gles || vrend_state.use_core_profile) {
                   for (unsigned int i = 0; i < 4; ++i) {
                      glTexParameteri(tview->texture->target, GL_TEXTURE_SWIZZLE_R + i, swizzle[i]);
                   }
@@ -6801,7 +6801,7 @@
       if (state->offset_line) {
          report_gles_warn(ctx, GLES_WARN_OFFSET_LINE);
       }
-   } else if (state->offset_line) {
+   } else if (!vrend_state.use_core_profile && state->offset_line) {
       glEnable(GL_POLYGON_OFFSET_LINE);
    } else {
       glDisable(GL_POLYGON_OFFSET_LINE);
@@ -6811,7 +6811,7 @@
       if (state->offset_point) {
          report_gles_warn(ctx, GLES_WARN_OFFSET_POINT);
       }
-   } else if (state->offset_point) {
+   } else if (!vrend_state.use_core_profile && state->offset_point) {
       glEnable(GL_POLYGON_OFFSET_POINT);
    } else {
       glDisable(GL_POLYGON_OFFSET_POINT);
@@ -9713,7 +9713,7 @@
    }
 
    /* read-color clamping is handled in the mesa frontend */
-   if (!vrend_state.use_gles) {
+   if (!vrend_state.use_gles && !vrend_state.use_core_profile) {
        glClampColor(GL_CLAMP_READ_COLOR_ARB, GL_FALSE);
    }
 
